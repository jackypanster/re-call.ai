# SuperMemory 技术架构文档（Technical Architecture for SuperMemory / re-call）

## 🧠 系统总览

SuperMemory（代号：re-call）是一个 AI 驱动的个人记忆增强系统，其技术架构目标是：

* 支撑文本类信息的快速记录、摘要、分类与向量化存储
* 通过语义检索技术实现记忆片段的精准回溯
* 采用松耦合、模块化、可替换的设计，便于持续迭代和部署
* **第一阶段优先使用 SaaS 云服务完成 MVP 快速落地，后续逐步引入本地部署方案**

## 📐 架构分层图（逻辑视图）

```text
┌─────────────────────────────┐
│         Web UI / API        │ ◄──── 用户交互（文本记录/检索）
└─────────────────────────────┘
                │
                ▼
┌─────────────────────────────┐
│        应用服务层（FastAPI） │ ◄──── REST 接口聚合
└─────────────────────────────┘
                │
      ┌─────────┼──────────┐
      ▼                     ▼
┌───────────────┐   ┌────────────────┐
│ 大模型调用模块 │   │  向量搜索模块   │
│（总结/分类/Embedding）│   │（Weaviate / Qdrant）│
└───────────────┘   └────────────────┘
      │                     ▲
      ▼                     │
┌─────────────────────────────┐
│         数据存储层（PostgreSQL + 向量库）  │
└─────────────────────────────┘
```

## 🔧 技术组件清单

| 层级 | 模块           | 技术选型（SaaS 优先）                      | 可替换方案（本地部署）                         |
| -- | ------------ | ---------------------------------- | ----------------------------------- |
| 前端 | UI 页面        | Vercel + Next.js + TailwindCSS     | Vite + React / Vue                  |
| 后端 | API 接口       | FastAPI（部署到 Railway / Render）      | Flask / Node.js + 本地容器              |
| 模型 | 文本摘要+标签      | GPT-4 / Claude（OpenRouter）         | HuggingFace 本地模型                    |
| 模型 | 文本 embedding | OpenAI Embedding / HuggingFace API | `sentence-transformers` / 本地 BGE 模型 |
| 检索 | 向量库          | Qdrant Cloud / Weaviate Cloud      | 本地 Chroma / Milvus                  |
| 存储 | 元数据          | Supabase（Postgres）                 | 本地 Postgres / MongoDB               |

## 🔄 模块调用流程（MVP阶段）

```text
[1] 用户提交文本 →
[2] FastAPI 接收记录 →
[3] LLM摘要分类 →
[4] 向量化 →
[5] 存储文本+元信息+向量 →
[6] 用户搜索 →
[7] 语义检索相似内容 →
[8] 返回匹配记录
```

## 🔌 外部依赖（SaaS 优先策略）

| 功能        | SaaS平台 / API                                     | 用途          |
| --------- | ------------------------------------------------ | ----------- |
| 模型调用      | OpenRouter（统一调用 GPT-4、Claude、Qwen）               | 摘要、关键词、标签生成 |
| Embedding | OpenAI Embedding API / HuggingFace Inference API | 文本向量生成      |
| UI 托管     | Vercel（Next.js 托管）                               | 前端部署快速启动    |
| API 托管    | Railway / Render                                 | 后端服务部署      |
| 数据托管      | Supabase（PostgreSQL + storage）                   | 元数据管理       |
| 向量检索      | Qdrant Cloud（免费配额）                               | 高速语义检索      |

## 🧪 部署与测试建议

* 开发环境：本地 `.env` 管理所有 SaaS key 和服务 URL
* SaaS 首发策略：优先验证价值、减少系统维护负担
* 支持阶段性替换模块：各模块通过环境变量灵活切换

## 🛡️ 安全与隐私考量

| 类型         | 措施建议                         |
| ---------- | ---------------------------- |
| 用户数据       | 所有文本记录需加密传输与存储（HTTPS + 字段加密） |
| API key 管理 | 使用 `.env` 配置 + 云函数密钥存储       |
| 向量数据       | 隐私敏感数据不进行 embedding 或采用模糊化策略 |

## 🚀 演进设计（预留接口）

* 模型适配层（可插拔不同 LLM）
* 语音/图像输入预处理管线（未来）
* 用户记忆图谱构建模块（知识图谱引擎）
* 数字遗产导出与授权控制（加密签名）

---

本技术文档用于配合《SuperMemory MVP 产品说明文档（re-call）》开发部署所用。
第一阶段采用 SaaS 快速验证架构，后续逐步过渡到本地部署与私有化模块替换。
每当功能结构变更时，请同步更新此文档，并与产品需求文档保持一致。
